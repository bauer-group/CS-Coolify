name: âœ… Validate

on:
  pull_request:
    paths:
      - 'docker-compose.yml'
      - '*.sh'
      - 'server-setup/**/*.sh'
  push:
    branches: [main]
    paths:
      - 'docker-compose.yml'
      - '*.sh'
      - 'server-setup/**/*.sh'

jobs:
  validate-compose:
    name: ðŸ³ Docker Compose
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ðŸ“ Create dummy .env
        run: |
          cat > .env << 'EOF'
          APP_ID=test
          APP_KEY=base64:test
          DB_PASSWORD=test
          REDIS_PASSWORD=test
          PUSHER_APP_ID=test
          PUSHER_APP_KEY=test
          PUSHER_APP_SECRET=test
          ROOT_USERNAME=admin
          ROOT_USER_EMAIL=test@test.com
          ROOT_USER_PASSWORD=test
          EOF

      - name: ðŸ” Validate docker-compose.yml
        run: docker compose -f docker-compose.yml config --quiet

  shellcheck:
    name: ðŸš Shellcheck
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ðŸ” Run Shellcheck
        uses: ludeeus/action-shellcheck@master
        with:
          scandir: '.'
          severity: warning
